version: "3.3"

services:
  nats:
    image: nats
    container_name: nats
    networks:
      - main-network
  
  caddy:
    image: caddy
    container_name: caddy
    restart: always
    ports:
      - "443:443"
      - "80:80"
    networks:
      - main-network
    volumes:
      - "./Caddyfile:/etc/caddy/Caddyfile"
      - $PWD/.caddy/data:/data
      - $PWD/.caddy/config:/config

  mongo:
    image: bitnami/mongodb
    container_name: db
    restart: always
    env_file: docker-compose.env
    ports:
      - "27017:27017"
    volumes:
      - /usr/local/var/mongodb/:/bitnami/mongodb
    networks:
      - main-network

  zookeeper:
    image: 'bitnami/zookeeper:latest'
    container_name: zookeeper
    env_file: docker-compose.env
    ports:
      - '2181:2181'
    volumes:
      - ../zookeeper/data:/bitnami/zookeeper
    networks:
      - main-network

# Make the externally created network "gateway" available as network "default"
networks:
  main-network:
    external: true